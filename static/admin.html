<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GamePulse Admin Console</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/admin/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><img src="/static/app-icon.png" alt="GamePulse"></div>
            <div>
                <div class="sidebar-title">GamePulse</div>
                <div class="sidebar-subtitle">Admin Console</div>
            </div>
        </div>

        <nav>
            <div class="nav-section">
                <div class="nav-section-title">Overview</div>
                <div class="nav-item active" data-section="dashboard">
                    <span class="nav-item-icon"><i data-lucide="layout-dashboard" class="icon-sm"></i></span>
                    Dashboard
                </div>
                <div class="nav-item" data-section="activity">
                    <span class="nav-item-icon"><i data-lucide="scroll-text" class="icon-sm"></i></span>
                    Activity Log
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Operations</div>
                <div class="nav-item" data-section="status">
                    <span class="nav-item-icon"><i data-lucide="monitor" class="icon-sm"></i></span>
                    System Status
                </div>
                <div class="nav-item" data-section="cache">
                    <span class="nav-item-icon"><i data-lucide="database" class="icon-sm"></i></span>
                    Cache Management
                </div>
                <div class="nav-item" data-section="sports">
                    <span class="nav-item-icon"><i data-lucide="trophy" class="icon-sm"></i></span>
                    Sports Providers
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Notifications</div>
                <div class="nav-item" data-section="push">
                    <span class="nav-item-icon"><i data-lucide="bell" class="icon-sm"></i></span>
                    Push Notifications
                </div>
                <div class="nav-item" data-section="goal-test">
                    <span class="nav-item-icon"><i data-lucide="circle-dot" class="icon-sm"></i></span>
                    Goal Testing
                </div>
                <div class="nav-item" data-section="pregame-test">
                    <span class="nav-item-icon"><i data-lucide="timer" class="icon-sm"></i></span>
                    Event Start Testing
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Games</div>
                <div class="nav-item" data-section="create-game">
                    <span class="nav-item-icon"><i data-lucide="plus-circle" class="icon-sm"></i></span>
                    Create Game
                </div>
                <div class="nav-item" data-section="games">
                    <span class="nav-item-icon"><i data-lucide="gamepad-2" class="icon-sm"></i></span>
                    Manual Games
                </div>
            </div>
        </nav>
    </aside>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open menu">
                    <i data-lucide="menu" class="icon-md"></i>
                </button>
                <h1 class="page-title" id="page-title">Dashboard</h1>
            </div>
            <div class="top-bar-actions">
                <div class="status-indicator">
                    <span class="status-dot" id="server-status-dot"></span>
                    <span id="server-status-text">Online</span>
                </div>
                <button class="btn btn-secondary" id="refresh-all">
                    <i data-lucide="refresh-cw" class="icon-btn"></i> Refresh All
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="section-dashboard" class="page-section">
            <!-- Metrics Cards -->
            <div class="dashboard-grid" id="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Uptime</span>
                        <div class="metric-icon blue"><i data-lucide="clock" class="icon-md"></i></div>
                    </div>
                    <div class="metric-value" id="metric-uptime">-</div>
                    <div class="metric-change" id="metric-uptime-sub">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Goals Detected</span>
                        <div class="metric-icon green"><i data-lucide="target" class="icon-md"></i></div>
                    </div>
                    <div class="metric-value" id="metric-goals">0</div>
                    <div class="metric-change" id="metric-goals-sub">Total goals</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Notifications Sent</span>
                        <div class="metric-icon purple"><i data-lucide="bell-ring" class="icon-md"></i></div>
                    </div>
                    <div class="metric-value" id="metric-notifications">0</div>
                    <div class="metric-change" id="metric-notifications-sub">Push notifications</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Live Games</span>
                        <div class="metric-icon cyan"><i data-lucide="radio" class="icon-md"></i></div>
                    </div>
                    <div class="metric-value" id="metric-live-games">0</div>
                    <div class="metric-change" id="metric-live-games-sub">Currently tracking</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Cache Status</span>
                        <div class="metric-icon orange"><i data-lucide="hard-drive" class="icon-md"></i></div>
                    </div>
                    <div class="metric-value" id="metric-cache">-</div>
                    <div class="cache-status-list" id="cache-status-list"></div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Notification Activity (Last 24h)</h3>
                        <div class="chart-legend">
                            <div class="chart-legend-item">
                                <span class="legend-dot" style="background: #3b82f6"></span>
                                Sent
                            </div>
                            <div class="chart-legend-item">
                                <span class="legend-dot" style="background: #22c55e"></span>
                                Goals
                            </div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="notifications-chart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Cache Performance</h3>
                        <div class="chart-legend">
                            <div class="chart-legend-item">
                                <span class="legend-dot" style="background: #22c55e"></span>
                                Hits
                            </div>
                            <div class="chart-legend-item">
                                <span class="legend-dot" style="background: #ef4444"></span>
                                Misses
                            </div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="cache-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="zap" class="icon-sm"></i></span>
                        <h2 class="section-title">Quick Actions</h2>
                    </div>
                </div>
                <div class="section-content">
                    <div class="btn-group">
                        <button class="btn btn-primary" id="quick-clear-cache"><i data-lucide="trash-2" class="icon-btn"></i> Clear All Caches</button>
                        <button class="btn btn-secondary" id="quick-run-notifier"><i data-lucide="search" class="icon-btn"></i> Run Notifier Check</button>
                        <button class="btn btn-secondary" id="quick-goal-check"><i data-lucide="target" class="icon-btn"></i> Run Goal Check</button>
                        <button class="btn btn-secondary" id="quick-biathlon-refresh"><i data-lucide="snowflake" class="icon-btn"></i> Refresh Biathlon</button>
                    </div>
                    <div id="quick-actions-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Activity Log Section -->
        <div id="section-activity" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="scroll-text" class="icon-sm"></i></span>
                        <h2 class="section-title">Recent Activity</h2>
                        <span class="section-badge" id="activity-count">0 events</span>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="activity-list" id="activity-list">
                        <p class="text-muted">Loading activity...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status Section -->
        <div id="section-status" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="monitor" class="icon-sm"></i></span>
                        <h2 class="section-title">System Status</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="status-grid" id="status-grid"></div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-secondary" id="refresh-status"><i data-lucide="refresh-cw" class="icon-btn"></i> Refresh Status</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cache Management Section -->
        <div id="section-cache" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="database" class="icon-sm"></i></span>
                        <h2 class="section-title">Cache Management</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="status-grid" id="cache-status-grid"></div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-danger" id="clear-cache"><i data-lucide="trash-2" class="icon-btn"></i> Clear All Caches</button>
                        <button class="btn btn-secondary" id="refresh-cache-status"><i data-lucide="refresh-cw" class="icon-btn"></i> Refresh</button>
                    </div>
                    <div id="cache-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Sports Providers Section -->
        <div id="section-sports" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="trophy" class="icon-sm"></i></span>
                        <h2 class="section-title">Sports Providers</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="status-grid" id="sports-grid"></div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-secondary" id="refresh-sports"><i data-lucide="refresh-cw" class="icon-btn"></i> Refresh Sports List</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Push Notifications Section -->
        <div id="section-push" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="bell" class="icon-sm"></i></span>
                        <h2 class="section-title">Push Notification Status (FCM)</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="status-grid" id="push-status-grid"></div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-secondary" id="refresh-push-status"><i data-lucide="refresh-cw" class="icon-btn"></i> Refresh Status</button>
                        <button class="btn btn-secondary" id="run-goal-watcher"><i data-lucide="target" class="icon-btn"></i> Run Goal Check</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="send" class="icon-sm"></i></span>
                        <h2 class="section-title">Send Test Notification</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="test-push-message">Message (optional)</label>
                            <input id="test-push-message" type="text" class="form-control" placeholder="Custom message for test notification" />
                        </div>
                        <div class="form-group">
                            <label for="test-push-target-type">Target type</label>
                            <select id="test-push-target-type" class="form-control">
                                <option value="topic">Topic (goal_notifications)</option>
                                <option value="token">Device Token</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="test-push-target-id">Device Token (optional)</label>
                            <input id="test-push-target-id" type="text" class="form-control" placeholder="FCM device token" />
                        </div>
                    </div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-primary" id="send-test-push"><i data-lucide="send" class="icon-btn"></i> Send Test Notification</button>
                    </div>
                    <div id="push-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="alert-triangle" class="icon-sm"></i></span>
                        <h2 class="section-title">FCM Error Log</h2>
                        <span class="section-badge" id="fcm-error-count">0 errors</span>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="btn-group mb-2">
                        <button class="btn btn-secondary" id="refresh-error-log"><i data-lucide="refresh-cw" class="icon-btn"></i> Refresh</button>
                        <button class="btn btn-danger" id="clear-error-log"><i data-lucide="trash-2" class="icon-btn"></i> Clear Error Log</button>
                    </div>
                    <div class="error-log-list" id="fcm-error-log">
                        <p class="text-muted">Loading error log...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goal Testing Section -->
        <div id="section-goal-test" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="circle-dot" class="icon-sm"></i></span>
                        <h2 class="section-title">Goal Notification Test</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="goal-test-sport">Sport</label>
                            <select id="goal-test-sport" class="form-control">
                                <option value="shl">SHL</option>
                                <option value="allsvenskan">Allsvenskan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="goal-test-scoring-team">Scoring team</label>
                            <select id="goal-test-scoring-team" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label for="goal-test-opposing-team">Opposing team</label>
                            <select id="goal-test-opposing-team" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label for="goal-test-scorer-name">Scorer name</label>
                            <input id="goal-test-scorer-name" type="text" class="form-control" placeholder="Test Scorer" />
                        </div>
                        <div class="form-group">
                            <label for="goal-test-home-score">Home score</label>
                            <input id="goal-test-home-score" type="number" min="0" class="form-control" placeholder="1" />
                        </div>
                        <div class="form-group">
                            <label for="goal-test-away-score">Away score</label>
                            <input id="goal-test-away-score" type="number" min="0" class="form-control" placeholder="0" />
                        </div>
                        <div class="form-group">
                            <label for="goal-test-period">Period/half</label>
                            <input id="goal-test-period" type="text" class="form-control" placeholder="P1" />
                        </div>
                        <div class="form-group">
                            <label for="goal-test-time">Time</label>
                            <input id="goal-test-time" type="text" class="form-control" placeholder="12:34" />
                        </div>
                        <div class="form-group">
                            <label for="goal-test-target-type">Target type</label>
                            <select id="goal-test-target-type" class="form-control">
                                <option value="topics">Team topics</option>
                                <option value="token">Device Token</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="goal-test-target-id">Device Token (optional)</label>
                            <input id="goal-test-target-id" type="text" class="form-control" placeholder="FCM device token" />
                        </div>
                    </div>
                    <div class="form-grid mt-2">
                        <div class="form-check">
                            <input id="goal-test-scoring-home" type="checkbox" checked />
                            <label for="goal-test-scoring-home">Scoring team is home team</label>
                        </div>
                        <div class="form-check">
                            <input id="goal-test-send-opposing" type="checkbox" checked />
                            <label for="goal-test-send-opposing">Send opposing notification</label>
                        </div>
                    </div>
                    <div class="btn-group mt-2">
                        <button class="btn btn-primary" id="send-goal-test"><i data-lucide="target" class="icon-btn"></i> Send Goal Test</button>
                    </div>
                    <div id="goal-test-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Pre-Game/Event Start Testing Section -->
        <div id="section-pregame-test" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="timer" class="icon-sm"></i></span>
                        <h2 class="section-title">Event Start Notification Test</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <p class="text-muted mb-2">Test pre-game reminder notifications for upcoming games or races.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="pregame-test-sport">Sport</label>
                            <select id="pregame-test-sport" class="form-control">
                                <option value="shl">SHL (Hockey)</option>
                                <option value="allsvenskan">Allsvenskan (Football)</option>
                                <option value="biathlon">Biathlon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pregame-test-minutes">Minutes until start</label>
                            <input id="pregame-test-minutes" type="number" min="1" max="60" class="form-control" value="5" />
                        </div>
                        <div class="form-group">
                            <label for="pregame-test-venue">Venue (optional)</label>
                            <input id="pregame-test-venue" type="text" class="form-control" placeholder="Arena name" />
                        </div>
                    </div>

                    <!-- Team sports fields (SHL & Allsvenskan) -->
                    <div id="pregame-team-fields" class="form-grid mt-2">
                        <div class="form-group">
                            <label for="pregame-test-home-team">Home team</label>
                            <select id="pregame-test-home-team" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label for="pregame-test-away-team">Away team</label>
                            <select id="pregame-test-away-team" class="form-control"></select>
                        </div>
                    </div>

                    <!-- Biathlon fields -->
                    <div id="pregame-biathlon-fields" class="form-grid mt-2 hidden">
                        <div class="form-group">
                            <label for="pregame-test-gender">Gender</label>
                            <select id="pregame-test-gender" class="form-control">
                                <option value="men">Men</option>
                                <option value="women">Women</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pregame-test-discipline">Discipline</label>
                            <select id="pregame-test-discipline" class="form-control">
                                <option value="Sprint">Sprint</option>
                                <option value="Pursuit">Pursuit</option>
                                <option value="Individual">Individual</option>
                                <option value="Mass Start">Mass Start</option>
                                <option value="Relay">Relay</option>
                                <option value="Mixed Relay">Mixed Relay</option>
                                <option value="Single Mixed Relay">Single Mixed Relay</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group mt-2">
                        <button class="btn btn-primary" id="send-pregame-test"><i data-lucide="timer" class="icon-btn"></i> Send Event Start Test</button>
                    </div>
                    <div id="pregame-test-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Create Game Section -->
        <div id="section-create-game" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="plus-circle" class="icon-sm"></i></span>
                        <h2 class="section-title">Create Manual Game</h2>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <form id="create-game-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="home-team">Home team</label>
                                <select id="home-team" class="form-control" required></select>
                            </div>
                            <div class="form-group">
                                <label for="away-team">Away team</label>
                                <select id="away-team" class="form-control" required></select>
                            </div>
                            <div class="form-group">
                                <label for="game-state">State</label>
                                <select id="game-state" class="form-control">
                                    <option value="live">Live</option>
                                    <option value="pre-game">Pre-game</option>
                                    <option value="post-game">Post-game</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="start-time">Start time</label>
                                <input id="start-time" type="datetime-local" class="form-control" required />
                            </div>
                            <div class="form-group">
                                <label for="venue">Venue</label>
                                <input id="venue" type="text" class="form-control" placeholder="Arena name" />
                            </div>
                            <div class="form-group">
                                <label for="home-score">Home score</label>
                                <input id="home-score" type="number" min="0" class="form-control" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="away-score">Away score</label>
                                <input id="away-score" type="number" min="0" class="form-control" value="0" />
                            </div>
                        </div>
                        <div class="btn-group mt-2">
                            <button type="submit" class="btn btn-primary"><i data-lucide="plus" class="icon-btn"></i> Create Game</button>
                        </div>
                    </form>
                    <div id="create-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Manual Games Section -->
        <div id="section-games" class="page-section hidden">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this.parentElement)">
                    <div class="section-title-group">
                        <span class="section-icon"><i data-lucide="gamepad-2" class="icon-sm"></i></span>
                        <h2 class="section-title">Manual Games</h2>
                        <span class="section-badge" id="games-badge">0 games</span>
                    </div>
                    <span class="section-toggle"><i data-lucide="chevron-down" class="icon-sm"></i></span>
                </div>
                <div class="section-content">
                    <div class="games-list" id="games-list"></div>
                    <div id="games-feedback" class="mt-2 text-sm"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="/static/admin/admin.js"></script>
</body>
</html>
